{"version":3,"sources":["../sourcemapped-stacktrace.js"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["/*\n * sourcemapped-stacktrace.js\n * created by James Salter <iteration@gmail.com> (2014)\n *\n * https://github.com/novocaine/sourcemapped-stacktrace\n *\n * Licensed under the New BSD license. See LICENSE or:\n * http://opensource.org/licenses/BSD-3-Clause\n */\n\nconst { SourceMapConsumer } = require('source-map/lib/source-map-consumer')\n\nvar global_mapForUri = {}\n\n/**\n * Re-map entries in a stacktrace using sourcemaps if available.\n *\n * @param {Array} stack - Array of strings from the browser's stack\n *                        representation. Currently only Chrome\n *                        format is supported.\n * @param {function} done - Callback invoked with the transformed stacktrace\n *                          (an Array of Strings) passed as the first\n *                          argument\n * @param {Object} [opts] - Optional options object.\n * @param {Function} [opts.filter] - Filter function applied to each stackTrace line.\n *                                   Lines which do not pass the filter won't be processesd.\n * @param {boolean} [opts.cacheGlobally] - Whether to cache sourcemaps globally across multiple calls.\n * @param {boolean} [opts.sync] - Whether to use synchronous ajax to load the sourcemaps.\n */\nvar mapStackTrace = function(stack, done, opts) {\n  var lines\n  var line\n  var mapForUri = {}\n  var rows = {}\n  var fields\n  var uri\n  var expected_fields\n  var regex\n  var skip_lines\n\n  var fetcher = new Fetcher(opts)\n\n  if (isChromeOrEdge() || isIE11Plus()) {\n    regex = /^ +at.+\\((.*):([0-9]+):([0-9]+)/\n    expected_fields = 4\n    // (skip first line containing exception message)\n    skip_lines = 1\n  } else if (isFirefox() || isSafari()) {\n    regex = /@(.*):([0-9]+):([0-9]+)/\n    expected_fields = 4\n    skip_lines = 0\n  } else {\n    throw new Error('unknown browser :(')\n  }\n\n  lines = stack.split('\\n').slice(skip_lines)\n\n  for (var i = 0; i < lines.length; i++) {\n    line = lines[i]\n    if (opts && opts.filter && !opts.filter(line)) continue\n\n    fields = line.match(regex)\n    if (fields && fields.length === expected_fields) {\n      rows[i] = fields\n      uri = fields[1]\n      if (!uri.match(/<anonymous>/)) {\n        fetcher.fetchScript(uri)\n      }\n    }\n  }\n\n  fetcher.sem.whenReady(function() {\n    var result = processSourceMaps(lines, rows, fetcher.mapForUri)\n    done(result)\n  })\n}\n\nvar isChromeOrEdge = function() {\n  return navigator.userAgent.toLowerCase().indexOf('chrome') > -1\n}\n\nvar isFirefox = function() {\n  return navigator.userAgent.toLowerCase().indexOf('firefox') > -1\n}\n\nvar isSafari = function() {\n  return navigator.userAgent.toLowerCase().indexOf('safari') > -1\n}\n\nvar isIE11Plus = function() {\n  return document.documentMode && document.documentMode >= 11\n}\n\nvar Semaphore = function() {\n  this.count = 0\n  this.pending = []\n}\n\nSemaphore.prototype.incr = function() {\n  this.count++\n}\n\nSemaphore.prototype.decr = function() {\n  this.count--\n  this.flush()\n}\n\nSemaphore.prototype.whenReady = function(fn) {\n  this.pending.push(fn)\n  this.flush()\n}\n\nSemaphore.prototype.flush = function() {\n  if (this.count === 0) {\n    this.pending.forEach(function(fn) {\n      fn()\n    })\n    this.pending = []\n  }\n}\n\nvar Fetcher = function(opts) {\n  this.sem = new Semaphore()\n  this.sync = opts && opts.sync\n  this.mapForUri = opts && opts.cacheGlobally ? global_mapForUri : {}\n}\n\nFetcher.prototype.ajax = function(uri, callback) {\n  var xhr = createXMLHTTPObject()\n  var that = this\n  xhr.onreadystatechange = function() {\n    if (xhr.readyState == 4) {\n      callback.call(that, xhr, uri)\n    }\n  }\n  xhr.open('GET', uri, !this.sync)\n  xhr.send()\n}\n\nFetcher.prototype.fetchScript = function(uri) {\n  if (!(uri in this.mapForUri)) {\n    this.sem.incr()\n    this.mapForUri[uri] = null\n  } else {\n    return\n  }\n\n  this.ajax(uri, this.onScriptLoad)\n}\n\nvar absUrlRegex = new RegExp('^(?:[a-z]+:)?//', 'i')\n\nFetcher.prototype.onScriptLoad = function(xhr, uri) {\n  if (\n    xhr.status === 200 ||\n    (uri.slice(0, 7) === 'file://' && xhr.status === 0)\n  ) {\n    // find .map in file.\n    //\n    // attempt to find it at the very end of the file, but tolerate trailing\n    // whitespace inserted by some packers.\n    var match = xhr.responseText.match(\n      '//# [s]ourceMappingURL=(.*)[\\\\s]*$',\n      'm'\n    )\n    if (match && match.length === 2) {\n      // get the map\n      var mapUri = match[1]\n\n      var embeddedSourceMap = mapUri.match(\n        'data:application/json;(charset=[^;]+;)?base64,(.*)'\n      )\n\n      if (embeddedSourceMap && embeddedSourceMap[2]) {\n        this.mapForUri[uri] = new source_map_consumer.SourceMapConsumer(\n          atob(embeddedSourceMap[2])\n        )\n        this.sem.decr()\n      } else {\n        if (!absUrlRegex.test(mapUri)) {\n          // relative url; according to sourcemaps spec is 'source origin'\n          var origin\n          var lastSlash = uri.lastIndexOf('/')\n          if (lastSlash !== -1) {\n            origin = uri.slice(0, lastSlash + 1)\n            mapUri = origin + mapUri\n            // note if lastSlash === -1, actual script uri has no slash\n            // somehow, so no way to use it as a prefix... we give up and try\n            // as absolute\n          }\n        }\n\n        this.ajax(mapUri, function(xhr) {\n          if (\n            xhr.status === 200 ||\n            (mapUri.slice(0, 7) === 'file://' && xhr.status === 0)\n          ) {\n            this.mapForUri[uri] = new source_map_consumer.SourceMapConsumer(\n              xhr.responseText\n            )\n          }\n          this.sem.decr()\n        })\n      }\n    } else {\n      // no map\n      this.sem.decr()\n    }\n  } else {\n    // HTTP error fetching uri of the script\n    this.sem.decr()\n  }\n}\n\nvar processSourceMaps = function(lines, rows, mapForUri) {\n  var result = []\n  var map\n  for (var i = 0; i < lines.length; i++) {\n    var row = rows[i]\n    if (row) {\n      var uri = row[1]\n      var line = parseInt(row[2], 10)\n      var column = parseInt(row[3], 10)\n      map = mapForUri[uri]\n\n      if (map) {\n        // we think we have a map for that uri. call source-map library\n        var origPos = map.originalPositionFor({ line: line, column: column })\n        result.push(\n          formatOriginalPosition(\n            origPos.source,\n            origPos.line,\n            origPos.column,\n            origPos.name || origName(lines[i])\n          )\n        )\n      } else {\n        // we can't find a map for that url, but we parsed the row.\n        // reformat unchanged line for consistency with the sourcemapped\n        // lines.\n        result.push(\n          formatOriginalPosition(uri, line, column, origName(lines[i]))\n        )\n      }\n    } else {\n      // we weren't able to parse the row, push back what we were given\n      result.push(lines[i])\n    }\n  }\n\n  return result\n}\n\nfunction origName(origLine) {\n  var match = String(origLine).match(\n    isChromeOrEdge() || isIE11Plus() ? / +at +([^ ]*).*/ : /([^@]*)@.*/\n  )\n  return match && match[1]\n}\n\nvar formatOriginalPosition = function(source, line, column, name) {\n  // mimic chrome's format\n  return (\n    '    at ' +\n    (name ? name : '(unknown)') +\n    ' (' +\n    source +\n    ':' +\n    line +\n    ':' +\n    column +\n    ')'\n  )\n}\n\n// xmlhttprequest boilerplate\nvar XMLHttpFactories = [\n  function() {\n    return new XMLHttpRequest()\n  },\n  function() {\n    return new ActiveXObject('Msxml2.XMLHTTP')\n  },\n  function() {\n    return new ActiveXObject('Msxml3.XMLHTTP')\n  },\n  function() {\n    return new ActiveXObject('Microsoft.XMLHTTP')\n  },\n]\n\nfunction createXMLHTTPObject() {\n  var xmlhttp = false\n  for (var i = 0; i < XMLHttpFactories.length; i++) {\n    try {\n      xmlhttp = XMLHttpFactories[i]()\n    } catch (e) {\n      continue\n    }\n    break\n  }\n  return xmlhttp\n}\n\nmodule.exports = { mapStackTrace }\n"]}